"use strict";
/*!
 * Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var url_1 = require("url");
// tslint:disable: valid-jsdoc
/**
 * @hidden
 */
function replaceSubdomain(issuerUrl, xsuaaUrl) {
    if (!isValidURL(issuerUrl)) {
        throw new Error('Jwt issuer url is not valid "' + issuerUrl + '".');
    }
    if (!isValidURL(xsuaaUrl)) {
        throw new Error('Xsuaa url is not valid "' + xsuaaUrl + '".');
    }
    var subdomain = parseSubdomain(issuerUrl);
    return replace(xsuaaUrl, subdomain);
}
exports.replaceSubdomain = replaceSubdomain;
function replace(xsuaaUrl, subdomain) {
    var parsedXsuaaUrl = new url_1.URL(xsuaaUrl);
    var scheme = parsedXsuaaUrl.protocol + '//';
    var xsuaaDomain = xsuaaUrl.slice(xsuaaUrl.indexOf('.'));
    return scheme + subdomain + xsuaaDomain;
}
function parseSubdomain(stringUrl) {
    var url = new url_1.URL(stringUrl);
    var host = url.host;
    if (!host || host.indexOf('.') === -1) {
        throw new Error('Failed to determine sub-domain: invalid host in "' + stringUrl + '".');
    }
    return host.split('.')[0];
}
function isValidURL(url) {
    try {
        var valid = new url_1.URL(url);
        return true;
    }
    catch (_) {
        return false;
    }
}
//# sourceMappingURL=subdomain-replacer.js.map